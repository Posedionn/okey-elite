<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>101 Okey Pro</title>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
body {
  margin:0;
  background:#0b5a2a;
  color:white;
  font-family:Arial;
  overflow:hidden;
}

#table {
  position:absolute;
  top:5%;
  left:5%;
  right:5%;
  bottom:30%;
  border-radius:50%;
  background:radial-gradient(circle,#0f7a3a,#064020);
  border:8px solid #3a2418;
}

.player {
  position:absolute;
  background:rgba(0,0,0,.6);
  padding:6px 12px;
  border-radius:14px;
  font-size:12px;
}

#p-top {top:5px; left:50%; transform:translateX(-50%)}
#p-left {left:5px; top:50%; transform:translateY(-50%) rotate(90deg)}
#p-right {right:5px; top:50%; transform:translateY(-50%) rotate(-90deg)}
#p-me {bottom:5px; left:50%; transform:translateX(-50%); color:#ffd700}

.center {
  position:absolute;
  top:20%;
  left:20%;
  right:20%;
  bottom:20%;
  display:flex;
  gap:10px;
}

.area {
  flex:1;
  border:2px dashed rgba(255,255,255,.3);
  border-radius:10px;
  padding:6px;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
}

.tile {
  width:32px;
  height:48px;
  background:#fffbe6;
  border-radius:4px;
  color:black;
  font-weight:bold;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:grab;
  box-shadow:1px 2px 4px rgba(0,0,0,.5);
}

.red{color:#d32f2f}
.blue{color:#1976d2}
.black{color:#000}
.orange{color:#ef6c00}

.locked {
  pointer-events:none;
  opacity:.9;
}

#rack {
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  background:#4a2c2a;
  padding:8px;
}

.rack-row {
  display:flex;
  gap:4px;
  justify-content:center;
  min-height:52px;
}

.controls {
  position:absolute;
  bottom:100px;
  left:0;
  right:0;
  display:flex;
  gap:6px;
  justify-content:center;
}

button {
  padding:6px 10px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="table">
  <div class="player" id="p-top">BOT 1</div>
  <div class="player" id="p-left">BOT 2</div>
  <div class="player" id="p-right">BOT 3</div>
  <div class="player" id="p-me">SEN</div>

  <div class="center">
    <div class="area" id="seriArea"></div>
    <div class="area" id="ciftArea"></div>
  </div>
</div>

<div class="controls">
  <button onclick="seriAc()">SERİ AÇ</button>
  <button onclick="ciftAc()">ÇİFT AÇ</button>
  <button onclick="yeniEl()">YENİ EL</button>
</div>

<div id="rack">
  <div class="rack-row" id="rack1"></div>
  <div class="rack-row" id="rack2"></div>
</div>

<script>
const colors=["red","blue","black","orange"];
let state={
  opened:false,
  temp:[]
};

function tile(n,c){
  const t=document.createElement("div");
  t.className="tile "+c;
  t.textContent=n;
  t.dataset.num=n;
  t.dataset.color=c;
  t.dataset.temp="false";
  return t;
}

function dagit(){
  rack1.innerHTML="";
  rack2.innerHTML="";
  for(let i=0;i<22;i++){
    const t=tile(Math.floor(Math.random()*13)+1,colors[Math.floor(Math.random()*4)]);
    (i<11?rack1:rack2).appendChild(t);
  }
}

function geriTopla(){
  state.temp.forEach(t=>rack1.appendChild(t));
  state.temp=[];
}

function onayla(){
  state.opened=true;
  state.temp.forEach(t=>{
    t.classList.add("locked");
    t.dataset.temp="false";
  });
  state.temp=[];
  alert("✅ El açıldı");
}

function toplam(){
  let s=0;
  document.querySelectorAll('[data-temp="true"]').forEach(t=>s+=parseInt(t.dataset.num));
  return s;
}

function seriKontrol(tiles){
  if(tiles.length<3) return false;
  const renk=tiles[0].dataset.color;
  let nums=tiles.map(t=>+t.dataset.num).sort((a,b)=>a-b);
  return tiles.every(t=>t.dataset.color===renk) &&
         nums.every((v,i)=>i===0||v===nums[i-1]+1);
}

function ciftKontrol(tiles){
  if(tiles.length<10) return false;
  let map={};
  tiles.forEach(t=>{
    map[t.dataset.num]=(map[t.dataset.num]||0)+1;
  });
  return Object.values(map).every(v=>v===2);
}

function seriAc(){
  const tiles=[...seriArea.children];
  tiles.forEach(t=>{t.dataset.temp="true"; state.temp.push(t)});
  if(!seriKontrol(tiles)||toplam()<101){
    alert("❌ Hatalı seri");
    geriTopla();
    return;
  }
  onayla();
}

function ciftAc(){
  const tiles=[...ciftArea.children];
  tiles.forEach(t=>{t.dataset.temp="true"; state.temp.push(t)});
  if(!ciftKontrol(tiles)||toplam()<101){
    alert("❌ Hatalı çift");
    geriTopla();
    return;
  }
  onayla();
}

function yeniEl(){
  document.querySelectorAll(".tile").forEach(t=>t.remove());
  seriArea.innerHTML="";
  ciftArea.innerHTML="";
  state.opened=false;
  state.temp=[];
  dagit();
}

[rack1,rack2,seriArea,ciftArea].forEach(el=>{
  new Sortable(el,{group:"okey",animation:150});
});

window.onload=dagit;
</script>

</body>
</html>
