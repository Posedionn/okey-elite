<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Elite 101 Okey - Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --board: #074e12; --tile: #fffde7; --rack-bg: #4a2c2a; }
        body { background: var(--board); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        
        /* 4 KiÅŸilik Masa DÃ¼zeni */
        .player-label { position: absolute; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; font-size: 12px; }
        #p-top { top: 10px; left: 50%; transform: translateX(-50%); }
        #p-left { top: 50%; left: 10px; transform: translateY(-50%) rotate(90deg); }
        #p-right { top: 50%; right: 10px; transform: translateY(-50%) rotate(-90deg); }
        #p-me { bottom: 180px; left: 50%; transform: translateX(-50%); color: #ffd700; font-weight: bold; }

        /* Oyun AlanÄ± ve TaÅŸ BÄ±rakma Yerleri */
        .center-area { position: absolute; top: 20%; left: 15%; width: 70%; height: 40%; border: 2px dashed rgba(255,255,255,0.2); border-radius: 20px; display: flex; align-items: center; justify-content: center; }
        .open-area { width: 50%; height: 80%; border-right: 1px solid rgba(255,255,255,0.3); padding: 5px; overflow-y: auto; }
        .pair-area { width: 50%; height: 80%; padding: 5px; overflow-y: auto; }

        /* Ortadaki Okey ve TaÅŸ Ã‡ekme Paneli */
        .deck-area { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 10px; }
        .draw-pile { width: 40px; height: 55px; background: #333; border: 2px solid #ccc; border-radius: 5px; text-align: center; line-height: 55px; cursor: pointer; }
        .okey-tile { width: 40px; height: 55px; background: var(--tile); color: #000; border-radius: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; }

        /* Ã‡ift SÄ±ra Istaka */
        .rack-wrapper { position: fixed; bottom: 65px; left: 0; right: 0; background: var(--rack-bg); padding: 10px 5px; border-top: 5px solid #3e2723; }
        .rack-row { display: flex; justify-content: center; gap: 4px; height: 52px; margin-bottom: 4px; min-height: 52px; }

        /* TaÅŸ TasarÄ±mÄ± */
        .tile { width: 32px; height: 48px; background: var(--tile); border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; color: #333; box-shadow: 1px 2px 3px #000; cursor: grab; }
        .black { color: #000; } .red { color: #d32f2f; } .blue { color: #1976d2; } .orange { color: #ef6c00; }

        /* Ä°statistik ve Kontrol Paneli */
        .stats { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; font-size: 12px; }
        .timer { position: fixed; top: 10px; left: 10px; font-size: 20px; color: #ffeb3b; }
        .controls { position: fixed; bottom: 0; width: 100%; height: 60px; display: flex; gap: 2px; background: #111; padding: 5px; box-sizing: border-box; }
        button { flex: 1; border: none; border-radius: 5px; font-weight: bold; color: white; cursor: pointer; font-size: 10px; }
    </style>
</head>
<body>

    <div class="timer" id="timer">45</div>
    <div class="stats">
        Seri Toplam: <span id="seri-sum">0</span><br>
        Ã‡ift SayÄ±sÄ±: <span id="pair-count">0</span>
    </div>

    <div class="player-label" id="p-top">Bilgisayar 1</div>
    <div class="player-label" id="p-left">Bilgisayar 2</div>
    <div class="player-label" id="p-right">Bilgisayar 3</div>
    <div class="player-label" id="p-me">SÄ°Z</div>

    <div class="center-area">
        <div class="open-area" id="my-open-area">DÃ¼z AÃ§Ä±lan</div>
        <div class="pair-area" id="my-pair-area">Ã‡ift AÃ§Ä±lan</div>
    </div>

    <div class="deck-area">
        <div class="draw-pile" onclick="tasCek()">ðŸŽ´</div>
        <div class="okey-tile"><span style="font-size: 10px">OKEY</span><span id="indicator">5</span></div>
    </div>

    <div class="rack-wrapper">
        <div class="rack-row" id="rack-1"></div>
        <div class="rack-row" id="rack-2"></div>
    </div>

    <div class="controls">
        <button style="background: #e67e22;" onclick="dagit()">DAÄžIT</button>
        <button style="background: #27ae60;" onclick="seriAc()">SERÄ° AÃ‡</button>
        <button style="background: #2980b9;" onclick="ciftAc()">Ã‡Ä°FT AÃ‡</button>
        <button style="background: #8e44ad;" onclick="seriDiz()">SERÄ° DÄ°Z</button>
        <button style="background: #c0392b;" onclick="location.reload()">YENÄ° EL</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        document.getElementById('p-me').innerText = tg.initDataUnsafe.user?.first_name.toUpperCase() || "SÄ°Z";

        const colors = ['black', 'blue', 'red', 'orange'];
        let timeLeft = 45;

        // SÃ¼rÃ¼kle BÄ±rak Ã–zelliÄŸi
        [document.getElementById('rack-1'), document.getElementById('rack-2'), document.getElementById('my-open-area'), document.getElementById('my-pair-area')].forEach(el => {
            new Sortable(el, { group: 'shared', animation: 150, onEnd: updateStats });
        });

        function dagit() {
            const r1 = document.getElementById('rack-1');
            const r2 = document.getElementById('rack-2');
            r1.innerHTML = ''; r2.innerHTML = '';
            for(let i=0; i<22; i++) {
                const n = Math.floor(Math.random() * 13) + 1;
                const c = colors[Math.floor(Math.random() * 4)];
                const t = `<div class="tile ${c}" data-val="${n}">${n}</div>`;
                if(i < 11) r1.innerHTML += t; else r2.innerHTML += t;
            }
            updateStats();
        }

        function updateStats() {
            let sum = 0;
            document.querySelectorAll('#my-open-area .tile').forEach(t => sum += parseInt(t.dataset.val));
            document.getElementById('seri-sum').innerText = sum;
            document.getElementById('pair-count').innerText = document.querySelectorAll('#my-pair-area .tile').length / 2;
        }

        function tasCek() {
            const t = `<div class="tile blue" data-val="7">7</div>`;
            document.getElementById('rack-1').innerHTML += t;
            tg.HapticFeedback.impactOccurred('light');
        }

        // Timer
        setInterval(() => {
            if(timeLeft > 0) {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
            } else {
                tg.showAlert("SÃ¼reniz doldu! TaÅŸ otomatik atÄ±lÄ±yor.");
                timeLeft = 45;
            }
        }, 1000);

        window.onload = dagit;
    </script>
</body>
</html>